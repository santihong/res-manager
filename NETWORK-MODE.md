# Network监听模式使用指南

## 功能介绍

Network监听模式是图片资源下载器的高级功能，可以实时捕获Chrome DevTools Network面板中的所有图片请求，包括：

- ✅ 动态加载的图片（AJAX/Fetch）
- ✅ 懒加载图片
- ✅ 预加载但未显示的图片
- ✅ 所有网络请求中的图片资源
- ✅ 显示图片的实际尺寸（宽×高）

## 与DOM解析模式的区别

| 特性 | DOM解析模式 | Network监听模式 |
|------|------------|----------------|
| 捕获范围 | 仅已渲染到页面的图片 | 所有网络请求的图片 |
| 动态加载 | ❌ 无法捕获未渲染的 | ✅ 实时捕获所有请求 |
| 图片尺寸 | ✅ 显示宽×高 | ✅ 显示宽×高 |
| 文件大小 | ❌ 不显示 | ✅ 从响应头获取 |
| 使用场景 | 快速下载页面图片 | 捕获所有图片请求 |

## 使用步骤

### 1. 打开插件并切换到Network模式

1. 点击浏览器工具栏的插件图标
2. 点击"Network监听"选项卡

### 2. 开始监听

1. 点击"🎯 开始监听"按钮
2. 插件开始实时捕获当前标签页的所有图片请求
3. 状态显示"正在监听Network请求..."

### 3. 浏览页面触发图片加载

- 滚动页面（触发懒加载）
- 点击按钮/链接（触发动态加载）
- 等待自动加载的内容
- 所有图片请求都会被自动捕获

### 4. 查看捕获的图片

捕获列表会实时更新，显示：
- 📷 图片缩略图
- 📏 图片尺寸（宽×高，如：1920×1080）
- 📄 文件名
- 🏷️ 图片格式（JPG/PNG/GIF等）
- 📦 文件大小（KB/MB）

### 5. 停止监听

点击"⏸️ 停止监听"按钮即可停止捕获新的图片请求

### 6. 下载图片

1. 点击"下载所有捕获的图片"按钮
2. 所有图片会自动下载到 `Downloads/images/时间戳/` 目录
3. 例如：`Downloads/images/20240213_143025/`

### 7. 清空列表

点击"🗑️ 清空列表"可以清空当前捕获的图片列表

## 使用场景示例

### 场景1：下载社交媒体图片

1. 打开Instagram/Twitter等社交媒体页面
2. 开启Network监听
3. 滚动页面加载更多图片
4. 所有加载的图片都会被捕获
5. 一键下载所有图片

### 场景2：捕获懒加载图片

1. 打开包含懒加载的网站
2. 开启Network监听
3. 慢慢滚动页面
4. 每张懒加载的图片都会被捕获
5. 下载所有图片

### 场景3：下载动态加载的图片

1. 打开图片画廊网站
2. 开启Network监听
3. 点击"加载更多"按钮
4. 新加载的图片自动被捕获
5. 批量下载

## 技术原理

Network监听模式使用Chrome的`webRequest` API来拦截所有网络请求：

```javascript
chrome.webRequest.onCompleted.addListener(
    (details) => {
        // 捕获图片请求
        // 获取URL、大小、状态码等信息
    },
    { 
        urls: ["<all_urls>"],
        types: ["image"]  // 仅监听图片类型
    },
    ["responseHeaders"]  // 获取响应头信息
);
```

## 注意事项

1. **权限要求**：需要`webRequest`权限
2. **性能影响**：监听会有轻微性能开销，不用时请停止监听
3. **隐私保护**：仅监听当前标签页，不会监听其他标签页
4. **图片尺寸**：尺寸信息通过异步加载获取，可能有短暂延迟
5. **文件大小**：从HTTP响应头的`Content-Length`获取，部分图片可能无此信息

## 常见问题

### Q: 为什么有些图片显示"加载中..."？

A: 图片尺寸需要异步加载，请稍等片刻会自动更新为实际尺寸（宽×高）。

### Q: 为什么有些图片大小显示"未知"？

A: 部分服务器不返回`Content-Length`响应头，无法获取文件大小。

### Q: 可以同时监听多个标签页吗？

A: 不可以，每次只能监听一个标签页。如需监听其他标签页，请切换到该标签页后重新开始监听。

### Q: 监听会影响浏览速度吗？

A: 影响极小，但建议不使用时停止监听以节省资源。

### Q: 捕获的图片会保存在哪里？

A: 图片信息临时存储在内存中，下载后会保存到`Downloads/images/时间戳/`目录。

## 更新日志

### v2.0.0 (2024-02-13)

- ✨ 新增Network监听模式
- ✨ 实时捕获所有图片网络请求
- ✨ 显示图片实际尺寸（宽×高）
- ✨ 显示文件大小信息
- ✨ 支持动态加载和懒加载图片
- 🎨 优化UI界面，添加图片缩略图
- 📝 完善文档说明

## 反馈与建议

如有问题或建议，欢迎反馈！
